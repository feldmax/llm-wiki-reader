<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation AI Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(to bottom, #f7f5f2, #e8e3db);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #d4a574, #c89b68);
            color: white;
            padding: 24px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 500;
        }

        .content {
            padding: 24px;
        }

        .section {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #c89b68;
        }

        .resource-item {
            background: #f9f9f9;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #e5e5e5;
        }

        .resource-controls {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            margin-top: 8px;
        }

        .depth-select {
            width: 180px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #c89b68;
            color: white;
        }

        .btn-primary:hover {
            background: #b88a5a;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-send {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            margin-top: 12px;
        }

        .chat-area {
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 16px;
            background: #fafafa;
            margin-bottom: 12px;
        }

        .message {
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 8px;
        }

        .message.user {
            background: #e8e3db;
            margin-left: 20%;
        }

        .message.assistant {
            background: white;
            margin-right: 20%;
            border: 1px solid #e5e5e5;
        }

        .message-label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 6px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #999;
        }

        .download-link {
            display: inline-block;
            margin-top: 12px;
            color: #c89b68;
            text-decoration: none;
            font-size: 14px;
        }

        .download-link:hover {
            text-decoration: underline;
        }

        .status {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .status.info {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
        }

        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìö Corporate Documentation AI Analyzer</h1>
    </div>

    <div class="content">
        <div class="section">
            <label class="section-title" for="llm-select">Select LLM</label>
            <select id="llm-select">
                <option value="claude">Claude.ai</option>
                <option value="gemini">Gemini (Google)</option>
                <option value="chatgpt">ChatGPT</option>
                <option value="grok">Grok</option>
                <option value="corporate">Corporate LLM Chat</option>
            </select>
        </div>

        <div class="section">
            <div class="section-title">Resources</div>
            <div id="resources-container"></div>
            <button class="btn btn-secondary" onclick="addResource()">+ Add Resource</button>
        </div>

        <div class="section">
            <label class="section-title" for="user-query">Your Question</label>
            <textarea id="user-query" rows="4" placeholder="Enter your question about the documentation..."></textarea>
        </div>

        <div id="status-container"></div>

        <button class="btn btn-primary btn-send" onclick="sendQuery()">Send</button>

        <div class="section" style="margin-top: 24px;">
            <div class="section-title">Chat</div>
            <div id="chat-area" class="chat-area"></div>
        </div>
    </div>
</div>

<script>
    let resources = [];
    let contextData = '';

    // Initialize with one resource field
    addResource();

    function addResource() {
        const id = Date.now();
        resources.push({ id, url: '', depth: 0 });
        renderResources();
    }

    function removeResource(id) {
        resources = resources.filter(r => r.id !== id);
        renderResources();
        if (resources.length === 0) {
            addResource();
        }
    }

    function updateResource(id, field, value) {
        const resource = resources.find(r => r.id === id);
        if (resource) {
            resource[field] = value;
        }
    }

    function renderResources() {
        const container = document.getElementById('resources-container');
        container.innerHTML = resources.map((resource, index) => `
            <div class="resource-item">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-weight: 500; font-size: 13px;">Resource ${index + 1}</span>
                    ${resources.length > 1 ? `<button class="btn btn-secondary" style="padding: 4px 12px; font-size: 12px;" onclick="removeResource(${resource.id})">Remove</button>` : ''}
                </div>
                <input
                    type="url"
                    placeholder="https://wiki.example.com/page"
                    value="${resource.url}"
                    onchange="updateResource(${resource.id}, 'url', this.value)"
                />
                <div class="resource-controls">
                    <div></div>
                    <select class="depth-select" onchange="updateResource(${resource.id}, 'depth', parseInt(this.value))">
                        <option value="0" ${resource.depth === 0 ? 'selected' : ''}>Depth: 0 (Current page)</option>
                        <option value="1" ${resource.depth === 1 ? 'selected' : ''}>Depth: 1 (+ 1 level)</option>
                        <option value="2" ${resource.depth === 2 ? 'selected' : ''}>Depth: 2 (+ 2 levels)</option>
                        <option value="3" ${resource.depth === 3 ? 'selected' : ''}>Depth: 3 (+ 3 levels)</option>
                        <option value="4" ${resource.depth === 4 ? 'selected' : ''}>Depth: 4 (+ 4 levels)</option>
                    </select>
                </div>
            </div>
        `).join('');
    }

    function showStatus(message, type = 'info') {
        const container = document.getElementById('status-container');
        container.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    function clearStatus() {
        document.getElementById('status-container').innerHTML = '';
    }

    async function fetchPageContent(url) {
        try {
            const response = await fetch(url);
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            // Remove scripts, styles, and other non-content elements
            const elementsToRemove = doc.querySelectorAll('script, style, nav, header, footer, iframe');
            elementsToRemove.forEach(el => el.remove());

            // Extract text content
            const textContent = doc.body.innerText || doc.body.textContent;

            // Extract links for crawling
            const links = Array.from(doc.querySelectorAll('a[href]'))
                .map(a => {
                    try {
                        return new URL(a.href, url).href;
                    } catch {
                        return null;
                    }
                })
                .filter(link => link && link.startsWith('http'));

            return { text: textContent, links: [...new Set(links)] };
        } catch (error) {
            console.error(`Error fetching ${url}:`, error);
            return { text: '', links: [] };
        }
    }

    async function crawlPages(startUrl, maxDepth, visitedUrls = new Set()) {
        if (maxDepth < 0 || visitedUrls.has(startUrl)) {
            return '';
        }

        visitedUrls.add(startUrl);
        showStatus(`Fetching: ${startUrl} (depth: ${maxDepth})`, 'info');

        const { text, links } = await fetchPageContent(startUrl);
        let allContent = `\n\n=== PAGE: ${startUrl} ===\n\n${text}\n`;

        if (maxDepth > 0) {
            // Get same-domain links only
            const baseDomain = new URL(startUrl).origin;
            const sameDomainLinks = links.filter(link => {
                try {
                    return new URL(link).origin === baseDomain;
                } catch {
                    return false;
                }
            }).slice(0, 10); // Limit to 10 links per page to avoid overwhelming

            for (const link of sameDomainLinks) {
                if (!visitedUrls.has(link)) {
                    const childContent = await crawlPages(link, maxDepth - 1, visitedUrls);
                    allContent += childContent;
                }
            }
        }

        return allContent;
    }

    async function collectContext() {
        const validResources = resources.filter(r => r.url.trim() !== '');

        if (validResources.length === 0) {
            throw new Error('Please add at least one valid URL');
        }

        let fullContext = '=== CORPORATE DOCUMENTATION CONTEXT ===\n';
        fullContext += `Generated: ${new Date().toISOString()}\n`;
        fullContext += `Total Resources: ${validResources.length}\n\n`;

        const visitedUrls = new Set();

        for (const resource of validResources) {
            showStatus(`Processing resource: ${resource.url}`, 'info');
            const content = await crawlPages(resource.url, resource.depth, visitedUrls);
            fullContext += content;
        }

        return fullContext;
    }

    function addMessageToChat(role, content, contextFile = null) {
        const chatArea = document.getElementById('chat-area');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${role}`;

        let html = `<div class="message-label">${role === 'user' ? 'You' : 'Assistant'}</div>`;
        html += `<div>${content.replace(/\n/g, '<br>')}</div>`;

        if (contextFile) {
            const blob = new Blob([contextFile], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            html += `<a href="${url}" download="context_${Date.now()}.txt" class="download-link">üìé Download Context File</a>`;
        }

        messageDiv.innerHTML = html;
        chatArea.appendChild(messageDiv);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    async function sendQuery() {
        const query = document.getElementById('user-query').value.trim();
        const llmSelect = document.getElementById('llm-select').value;

        if (!query) {
            showStatus('Please enter a question', 'error');
            return;
        }

        clearStatus();
        addMessageToChat('user', query);

        try {
            showStatus('Collecting documentation context...', 'info');
            contextData = await collectContext();

            showStatus('Context collected! Opening LLM chat...', 'success');

            // Prepare the prompt
            const fullPrompt = `Based on the following corporate documentation context, please answer this question:\n\n${query}\n\n--- CONTEXT ---\n${contextData}`;

            // Open appropriate LLM
            const llmUrls = {
                'claude': 'https://claude.ai/new',
                'gemini': 'https://gemini.google.com',
                'chatgpt': 'https://chatgpt.com',
                'grok': 'https://grok.com',
                'corporate': 'https://sapit-core-playground-vole.ai-launchpad.prod.eu-central-1.aws.apps.ml.hana.ondemand.com/aic/index.html#/generativeaihub?workspace=sap-genai-xl&resourceGroup=default&/g/promptchat'
            };

            // Copy to clipboard for easy pasting
            await navigator.clipboard.writeText(fullPrompt);

            addMessageToChat('assistant',
                `‚úÖ Context has been collected from ${resources.filter(r => r.url).length} resource(s).\n\n` +
                `üìã The full prompt (with context) has been copied to your clipboard.\n\n` +
                `üöÄ Opening ${llmSelect} in a new tab. Please paste the prompt there.\n\n` +
                `üíæ You can also download the context file below.`,
                contextData
            );

            window.open(llmUrls[llmSelect], '_blank');
            clearStatus();

        } catch (error) {
            showStatus(`Error: ${error.message}`, 'error');
            addMessageToChat('assistant', `‚ùå Error: ${error.message}`);
        }
    }
</script>
</body>
</html>
